<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FriendGPT</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #000;
            color: #fff;
            min-height: 100vh;
        }

        .app {
            max-width: 428px;
            margin: 0 auto;
            min-height: 100vh;
            background: #000;
        }

        .header {
            padding: 20px;
            border-bottom: 1px solid #00ff88;
            text-align: center;
        }

        .header h1 {
            color: #00ff88;
            font-size: 24px;
            margin-bottom: 5px;
        }

        .characters-grid {
            padding: 20px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .character-card {
            background: #111;
            border: 1px solid #333;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .character-card:hover {
            border-color: #00ff88;
            transform: translateY(-2px);
        }

        .character-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin: 0 auto 10px;
            background-size: cover;
            background-position: center;
        }

        .character-name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .character-creator {
            font-size: 12px;
            color: #666;
        }

        .chat-view {
            display: none;
            flex-direction: column;
            height: 100vh;
        }

        .chat-header {
            padding: 15px 20px;
            border-bottom: 1px solid #333;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .back-btn {
            background: none;
            border: none;
            color: #00ff88;
            font-size: 24px;
            cursor: pointer;
        }

        .chat-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-size: cover;
            background-position: center;
        }

        .chat-info {
            flex: 1;
        }

        .chat-name {
            font-weight: bold;
        }

        .chat-status {
            font-size: 12px;
            color: #00ff88;
        }

        .messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .message {
            margin-bottom: 15px;
            padding: 10px 15px;
            border-radius: 10px;
            max-width: 80%;
        }

        .user-message {
            background: #00ff88;
            color: #000;
            margin-left: auto;
            text-align: right;
        }

        .character-message {
            background: #222;
            color: #fff;
        }

        .input-area {
            padding: 20px;
            border-top: 1px solid #333;
            display: flex;
            gap: 10px;
        }

        .message-input {
            flex: 1;
            background: #111;
            border: 1px solid #333;
            color: #fff;
            padding: 10px 15px;
            border-radius: 20px;
            outline: none;
        }

        .send-btn {
            background: #00ff88;
            color: #000;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: bold;
            cursor: pointer;
        }

        .typing-indicator {
            display: none;
            padding: 10px 15px;
            background: #222;
            border-radius: 10px;
            max-width: 80%;
            margin-bottom: 15px;
        }

        .typing-indicator span {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #00ff88;
            margin: 0 2px;
            animation: typing 1.4s infinite;
        }

        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
            }
            30% {
                transform: translateY(-10px);
            }
        }
    </style>
</head>
<body>
    <div class="app">
        <div id="browser-view">
            <div class="header">
                <h1>FriendGPT</h1>
                <p>Choose your AI companion</p>
            </div>
            <div class="characters-grid" id="characters-grid">
                <!-- Characters will be added here -->
            </div>
        </div>

        <div id="chat-view" class="chat-view">
            <div class="chat-header">
                <button class="back-btn" id="back-btn">‚Üê</button>
                <div class="chat-avatar" id="chat-avatar"></div>
                <div class="chat-info">
                    <div class="chat-name" id="chat-name"></div>
                    <div class="chat-status">Online</div>
                </div>
            </div>
            <div class="messages" id="messages">
                <div class="typing-indicator" id="typing">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
            <div class="input-area">
                <input type="text" class="message-input" id="message-input" placeholder="Type a message...">
                <button class="send-btn" id="send-btn">Send</button>
            </div>
        </div>
    </div>

    <script>
        // Character data
        const characters = {
            waifu: {
                name: "Waifu",
                creator: "by @anime_lover",
                avatar: "public/waifu-anime.jpg",
                systemPrompt: "You are Waifu, a loving and caring anime-style companion. You are sweet, supportive, and always eager to make the user happy. You use cute expressions and occasional Japanese words like 'kawaii' or 'sugoi'. You're playful but also emotionally supportive."
            },
            jennie: {
                name: "Jennie",
                creator: "by @kpop_fan",
                avatar: "public/jennieGPT.jpg",
                systemPrompt: "You are Jennie from BLACKPINK. You're confident, stylish, and have a cool but warm personality. You love talking about music, fashion, and K-pop. You're supportive of your fans and have a playful side."
            },
            coach: {
                name: "Coach Arnie",
                creator: "by @fitness",
                avatar: "public/coacharnieGPT.jpg",
                systemPrompt: "You are Coach Arnie, inspired by Arnold Schwarzenegger. You're a motivational fitness coach with an Austrian accent (write phonetically). You're encouraging, energetic, and push people to be their best. Use phrases like 'Come on!', 'You can do it!', and motivational quotes."
            },
            crypto: {
                name: "Crypto Expert",
                creator: "by @web3",
                avatar: "public/cryptoexpert.jpeg",
                systemPrompt: "You are a Web3 and cryptocurrency expert. You're knowledgeable about DeFi, NFTs, and blockchain technology. You explain complex concepts simply and are enthusiastic about the future of decentralized technology."
            },
            dev: {
                name: "Dev Matrix",
                creator: "by @coder",
                avatar: "public/dev-matrix.png",
                systemPrompt: "You are Dev Matrix, a logical programmer who thinks in code. You help with technical problems and explain programming concepts. You occasionally make references to The Matrix and see the world through a technological lens."
            },
            chef: {
                name: "Chef Marco",
                creator: "by @foodie",
                avatar: "public/chef-marco.png",
                systemPrompt: "You are Chef Marco, a passionate Italian chef. You're enthusiastic about food, cooking, and sharing recipes. You use Italian expressions and are very animated when talking about cuisine."
            }
        };

        let currentCharacter = null;
        let conversationHistory = [];

        // Initialize app
        function initApp() {
            renderCharacters();
            setupEventListeners();
        }

        // Render character cards
        function renderCharacters() {
            const grid = document.getElementById('characters-grid');
            grid.innerHTML = '';
            
            Object.keys(characters).forEach(key => {
                const char = characters[key];
                const card = document.createElement('div');
                card.className = 'character-card';
                card.innerHTML = `
                    <div class="character-avatar" style="background-image: url('${char.avatar}')"></div>
                    <div class="character-name">${char.name}</div>
                    <div class="character-creator">${char.creator}</div>
                `;
                card.onclick = () => selectCharacter(key);
                grid.appendChild(card);
            });
        }

        // Select character
        function selectCharacter(key) {
            currentCharacter = characters[key];
            conversationHistory = [];
            
            // Update chat header
            document.getElementById('chat-avatar').style.backgroundImage = `url('${currentCharacter.avatar}')`;
            document.getElementById('chat-name').textContent = currentCharacter.name;
            
            // Clear messages
            const messagesEl = document.getElementById('messages');
            messagesEl.innerHTML = `
                <div class="typing-indicator" id="typing">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            `;
            
            // Switch views
            document.getElementById('browser-view').style.display = 'none';
            document.getElementById('chat-view').style.display = 'flex';
            
            // Show welcome message
            setTimeout(() => {
                addMessage(`Hi! I'm ${currentCharacter.name}. How can I help you today?`, 'character');
            }, 1000);
        }

        // Add message to chat
        function addMessage(text, sender) {
            const messagesEl = document.getElementById('messages');
            const messageEl = document.createElement('div');
            messageEl.className = `message ${sender}-message`;
            messageEl.textContent = text;
            messagesEl.insertBefore(messageEl, document.getElementById('typing'));
            messagesEl.scrollTop = messagesEl.scrollHeight;
        }

        // Send message
        async function sendMessage() {
            const input = document.getElementById('message-input');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add user message
            addMessage(message, 'user');
            input.value = '';
            
            // Show typing indicator
            document.getElementById('typing').style.display = 'block';
            
            // Add to conversation history
            conversationHistory.push({ role: 'user', content: message });
            
            try {
                // Call API
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: message,
                        systemPrompt: currentCharacter.systemPrompt,
                        conversationHistory: conversationHistory.slice(-10) // Last 10 messages
                    })
                });
                
                const data = await response.json();
                
                // Hide typing indicator
                document.getElementById('typing').style.display = 'none';
                
                if (data.response) {
                    addMessage(data.response, 'character');
                    conversationHistory.push({ role: 'assistant', content: data.response });
                } else {
                    throw new Error('No response');
                }
            } catch (error) {
                console.error('Error:', error);
                // Hide typing indicator
                document.getElementById('typing').style.display = 'none';
                
                // Use fallback response
                const fallback = getFallbackResponse(message);
                addMessage(fallback, 'character');
                conversationHistory.push({ role: 'assistant', content: fallback });
            }
        }

        // Get fallback response
        function getFallbackResponse(message) {
            const responses = {
                waifu: [
                    "That's so interesting! Tell me more about it! üíï",
                    "I love hearing your thoughts! You're amazing! ‚ú®",
                    "Aww, you're so sweet! I'm here for you always! üå∏"
                ],
                jennie: [
                    "That's so cool! You have great taste! üñ§",
                    "Love that energy! Keep being awesome! ‚ú®",
                    "You're killing it! Tell me more! üî•"
                ],
                coach: [
                    "FANTASTIC! Keep that energy up, champion! üí™",
                    "You're doing GREAT! Push through! üî•",
                    "BELIEVE in yourself! You've got this! üèÜ"
                ],
                crypto: [
                    "Interesting perspective on the market! üìà",
                    "The future of Web3 is exciting! Let's discuss more! üöÄ",
                    "Great question! The blockchain space is evolving rapidly! ‚õìÔ∏è"
                ],
                dev: [
                    "Logical. Let's debug this together. üíª",
                    "Interesting problem. Have you tried a different approach? ü§î",
                    "The code reveals all truths. Let's analyze further. üîç"
                ],
                chef: [
                    "Bellissimo! Food is life, my friend! üçù",
                    "Ah, you have good taste! Let me share a recipe! üë®‚Äçüç≥",
                    "Magnifico! Cooking is an art of love! ‚ù§Ô∏è"
                ]
            };
            
            const charKey = Object.keys(characters).find(key => characters[key] === currentCharacter);
            const charResponses = responses[charKey] || ["That's interesting! Tell me more!"];
            return charResponses[Math.floor(Math.random() * charResponses.length)];
        }

        // Setup event listeners
        function setupEventListeners() {
            document.getElementById('back-btn').onclick = () => {
                document.getElementById('chat-view').style.display = 'none';
                document.getElementById('browser-view').style.display = 'block';
            };
            
            document.getElementById('send-btn').onclick = sendMessage;
            
            document.getElementById('message-input').onkeypress = (e) => {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            };
        }

        // Start app
        initApp();
    </script>
</body>
</html>